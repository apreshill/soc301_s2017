---
title: SOC 301 Slides
subtitle: Pacific University
author: Chester Ismay
date: Spring 2017
output: 
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      highlightStyle: monokai
      highlightLines: true
    countIncrementalSlides: false
    css: example.css
---

```{r include=FALSE}
#options(servr.daemon = TRUE)
library(dplyr)
library(ggplot2)
knitr::opts_chunk$set(warning=FALSE, message=FALSE, fig.width=9.5, fig.height=4.5)
theme_set(theme_gray(base_size = 26))
```

layout: true

.footer[[Week 11 - Thursday](https://ismayc.github.io/soc301_s2017/2017/04/21/week-11---thursday/)]

---


name: week11th
class: center, middle

# Week 11 - Thursday

# April 13, 2017
---


# Review Midterm Exam

- Here are the [solutions](Midterm_ExamKey.pdf)

---

# RStudio Tools

### All hail the <small>`mosaic`</small> package. Load as usual: <small>`library(mosaic)`</small>

### The following four functions will give us (most of) the random simulation tools we need:

1. `rflip()`: Flip a coin
1. `shuffle()`: Shuffle a set of values (akin to cards)
1. `do()`: Do the same thing many, many, many times
1. `resample()`: the swiss army knife of functions

---

## R Simulations Example

### First load up RStudio

- Create new R script file, type the following commands (not the comments), and run them in your R Console

```{r, message=FALSE, echo=TRUE}
# Load packages, including mosaic package
library(dplyr)
library(ggplot2)
library(mosaic)

# Flip a coin once. Try this multiple times:
rflip()
```

---

## R Simulations Example

```{r echo=TRUE}
# Flip a coin 10 times. Try this multiple times:
rflip(10)
```

---

## R Simulations Example

```{r echo=TRUE}
# Flip a coin 10 times, but do this 5 times. Try this multiple times
do(5) * rflip(10)
```

---

## R Simulations Example

```{r echo=TRUE}
# Flip a coin 10 times, but do this 500 times
do(500) * rflip(10)
```

---

## R Simulations Example

```{r echo=TRUE}
# Gah! There are too many rows!
simulations <- do(500) * rflip(10)
```
```{r eval=FALSE, echo=TRUE}
# We could also View() it
View(simulations)
```

---

## R Simulations Example

```{r echo=TRUE, fig.height=5}
# Plot our resulting proportions
ggplot(data = simulations, aes(x = prop)) +
  geom_histogram(binwidth = 0.1, color = "white")
```

---

## R Simulations Example

```{r echo=TRUE, fig.height=5}
# Plot our resulting proportions
ggplot(data = simulations, mapping = aes(x = factor(prop))) +
  geom_bar()
```


---


## Shuffling AKA Permuting

Shuffling AKA re-ordering AKA **permuting** are all synonyms. I'm going to use
all three terms interchangeably. 

Type the following code into your R script:

```{r, eval=FALSE}
library(mosaic)
# Define a vector fruit
fruit <- c("apple", "orange", "mango")

# Do this multiple times:
shuffle(fruit)
```

---


## Shuffling AKA Permuting

This works with the `do()` operator...

```{r, eval=FALSE}
do(5) * shuffle(fruit)
```

... as well as within a `mutate()`



```{r, eval=FALSE}
example_data <- data_frame(
  name = c("Ilana", "Abbi", "Hannibal"),
  fruit = c("apple", "orange", "mango")
)

# Run this multiple times: 
example_data %>% mutate(fruit = shuffle(fruit))
```

---

## Key Distinction

### A *huge* distinction in types of sampling:

1. Sampling **with** replacement
1. Sampling **without** replacement

---

## Resampling

### At its most basic, `resample()` resamples the input vector **with** replacement. Run this in the console multiple times from your R script:

```{r, eval=FALSE}
resample(fruit)
```

* You can get the same fruit all three times i.e. sampling with replacement
* `resample()` has default settings that we can set to fit our needs; it is a swiss army knife.
* Let's unpack the defaults:

---


## Resampling

```{r, eval=FALSE}
resample(x = fruit, size = length(x), replace = TRUE, 
         prob = rep(1 / length(x), times = length(x)) )
```

* <small>`x`</small> is the input. In this case <small>`fruit`</small>.
* <small>`size`</small>: size of output vector. By default the same size as <small>`x`</small>.
* <small>`replace`</small>: Sample **with** or **without** replacement. By default with replacement.
* <small>`prob`</small>: Probability of sampling each input value. By default, equal probability
* Run the following.  What does it do?

```{r eval=FALSE}
rep(1/length(fruit), times = length(fruit))
```

---

## Scenario for Today

* Say you are a statistician and you meet someone called the "Lady Tasting Tea."
* She claims she can tell by tasting whether the tea or the milk was added first to a cup.
--

* You want to test whether
    + She can actually tell which came first **OR**
    + She's lying and is only guessing at random
--
* Say you have just enough tea/milk to pour into 10 cups.

---

## Lady Tasting Tea

* Lady Tasting Tea claims she can tell if tea or milk was poured first into a cup
* You run an experiment with 10 cups if she can tell or if she is bullshitting
* Let's _assume a hypothetical world where she is guessing at random_.

---

## Lady Tasting Tea

### If guessing at random, here are the *hypothetical* outcomes:

```{r, echo=FALSE, cache=TRUE, fig.height=5.5}
single_cup_outcome <- c(1, 0)
simulation <- do(10000) * resample(single_cup_outcome, size=10)
simulation <- simulation %>% 
  mutate(n_correct = V1 + V2 + V3 + V4 + V5 + V6 + V7 + V8 + V9 + V10) 
ggplot(simulation, aes(x=factor(n_correct))) + 
  geom_bar() +
  labs(x="Number of Guesses Correct")
```

---

## Lady Tasting Tea

She got 9/10 right!

```{r, cache=TRUE}
ggplot(simulation, aes(x = n_correct)) + 
  geom_bar() +
  labs(x="Number of Guesses Correct") +
  geom_vline(xintercept = 9, color = "red")
```

---

## Lady Tasting Tea

She got 9/10 right!

```{r, cache=TRUE}
ggplot(simulation, aes(x = n_correct)) + 
  geom_bar() +
  labs(x = "Number of Guesses Correct") +
  geom_vline(xintercept = 9, color = "red") +
  scale_x_continuous(breaks = 0:10)
```

---

## Lady Tasting Tea

* In our hypothetical world of guessing at random, 9/10 OR MORE occured 
`r sum(simulation$n_correct == 9) + sum(simulation$n_correct == 10)` times out of `r nrow(simulation)`. i.e. <br>
`r round(100*(sum(simulation$n_correct == 9) + sum(simulation$n_correct == 10))/nrow(simulation), 3)`% of the time. 
* Can she tell, or is she bullshitting?

---

## Problem Set 10

- Due by end of class today
- Turn in individually via pencil-and-paper

### [Learning Checks](https://ismayc.github.io/moderndiver-book/6-sim.html)

- LC6.1
- LC6.3
- LC6.9
- LC6.11
- LC6.13
- LC6.15

---

```{r old, child='temp_deck.Rmd'}
```