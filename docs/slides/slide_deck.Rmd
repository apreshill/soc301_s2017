---
title: SOC 301 Slides
subtitle: Pacific University
author: Chester Ismay
date: Spring 2017
output: 
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      highlightStyle: monokai
      highlightLines: true
    countIncrementalSlides: false
    css: example.css
---

```{r include=FALSE}
#options(servr.daemon = TRUE)
do <- mosaic::do
filter <- dplyr::filter
knitr::opts_chunk$set(warning=FALSE, message=FALSE, fig.width=9.5, fig.height=4.5)
theme_set(theme_gray(base_size = 26))
```

layout: true

.footer[[Week 12 - Tuesday](https://ismayc.github.io/soc301_s2017/2017/04/18/week-12---tuesday/)]

---


name: week12t
class: center, middle

# Week 12 - Tuesday

# April 18, 2017
---

class: center, middle

# WARMUP

<!--
Summarize Sections 7.1 - 7.5 in your own words in 4-5 sentences
-->

---

## Review Problem Set 10 from last time in pairs

- If not listed, review [Problem Set 10 Discussion](https://ismayc.github.io/soc301_s2017/problem-sets/ps-key/index.html#ps10-key)
***

<br>

.left-column[
- Jayla, Jeremy
- Rachel, Alicia F.
- Ariel, Alicia O.
- Alexandra, Tia
- Hannah, Kelsey
]

.right-column[
- Emily, Natasha
- Fernando, Karla
- Garrett, Daisy
- Lina, Bree
- Taylor, Cydni
]


---

## County Characteristics Datasets

### Annual County Resident Population Estimates by Age, Sex, Race, and Hispanic Origin

- Downloaded from [here](https://www2.census.gov/programs-surveys/popest/datasets/2010-2015/counties/asrh/) via <br> <small> `cc-est2015-alldata.csv` </small>
- Codebook is available [here](https://www2.census.gov/programs-surveys/popest/datasets/2010-2015/counties/asrh/cc-est2015-alldata.pdf)
- This dataset is NOT **tidy**.  I've tidied it and focused on only Total Population and Black or African American alone.

```{r message=FALSE, warning=FALSE}
# Remember to load the needed packages
library(dplyr)
library(mosaic)
library(ggplot2)
library(readr)
```

---

## Hypothesis Testing

### Comparing mean percentages in two states

- Suppose we were interested in testing the mean percentage of black residents in two different states.  Let's choose Oregon and Washington.
- Washington has 39 counties and Oregon has 36.
- Assume we only have access to 20 randomly selected counties from each state.

```{r eval=FALSE}
url <- "http://ismayc.github.io/wash-or_black.csv"
wash_or <- readr::read_csv(url) 
```

```{r include=FALSE}
wash_or <- read_csv("data/wash-or_black.csv")
```

---

## Problem set-up

### Do we have evidence that the mean percentage of black residents in Washington and Oregon is statistically different?

- What's the alternative hypothesis?
--

    - <small> $H_A: \mu_{wa} \ne \mu_{or}$ or $H_A: \mu_{wa} - \mu_{or} \ne 0$ </small>
    
- What is the null hypothesis?
--

    - <small> $H_0: \mu_{wa} = \mu_{or}$ or $H_0: \mu_{wa} - \mu_{or} = 0$ </small>

---

## The Hypotheses

- $H_0: \mu_{wa} - \mu_{or} = 0$ 
- $H_A: \mu_{wa} - \mu_{or} \ne 0$

### What do these mean in laymen terms?

--

- We are assuming that the mean percentage of black residents in Washington and Oregon is THE SAME.
- We will use hypothesis testing to look to see if we have evidence to go against this assumption in favor of the alternative hypothesis.

---

class: center, middle

## The layout of all hypothesis tests

```{r echo=FALSE}
knitr::include_graphics("figure/ht.png", dpi = 120)
```

---

## For our problem

### What is the *observational unit*?

```{r echo=FALSE}
wash_or %>% arrange(county) %>% select(county, state, black_perc) %>% 
                     sample_n(5) %>%
                     knitr::kable(format = "html")
```
--

<br>

- Counties in Washington and Oregon
---

## DATA:  

- We have collected our sample of 20 Washington counties and 20 Oregon counties

--

## TEST STATISTIC:  

- We are interested in the difference in sample means.

---

## OBSERVED EFFECT

```{r}
(state_means <- wash_or %>% group_by(state) %>% 
  summarize(mean_perc = mean(black_perc)))
(obs_diff <- diff(state_means$mean_perc))
```

- From our original (observed) sample, we have 

### $$\verb+obs_diff+ = \bar{x}_{wa} - \bar{x}_{or} = 0.9105771$$

---

## MODEL OF <small> $H_0$ </small>

### We assume that the two POPULATION mean percentages are the same:

- $H_0: \mu_{wa} = \mu_{or}$ <br> or <br> $H_0: \mu_{wa} - \mu_{or} = 0$

- EXTREMELY IMPORTANT NOTE:  Remember that PARAMETERS go in hypotheses NOT statistics!

---

## SIMULATED DATA 

### We want to use the data we have collected to simulate a process following the model for $H_0$.
--

### *BIG STEP* :  Assuming that <small> $H_0: \mu_{wa} = \mu_{or}$ </small>, any one of the percentages we saw in our sample data could have occurred (equally) in either Washington or in Oregon.

--

### We can use the `shuffle` function in the `mosaic` package to shuffle the percentages between Oregon and Washington.

---

## One shuffle

```{r}
set.seed(2016)
(shuffled_state_means <- wash_or %>%
     mutate(black_perc = shuffle(black_perc)) %>% 
     group_by(state) %>%
     summarize(mean_shuf_perc = mean(black_perc)))
(obs_shuf_diff <- diff(shuffled_state_means$mean_shuf_perc))
```

---

## NULL DISTRIBUTION

- Repeat this shuffling many times and then look at the distribution of all the resulting simulated test statistics

```{r cache=TRUE}
many_shuffles <- do(5000) *
  (shuffled_state_means <- wash_or %>%
     mutate(black_perc = shuffle(black_perc)) %>% 
     group_by(state) %>%
     summarize(mean_shuf_perc = mean(black_perc)))
rand_distn <- many_shuffles %>% 
  group_by(.index) %>% 
  summarize(diffmean = diff(mean_shuf_perc))
```

---

### Plot of NULL DISTRIBUTION

```{r fig.height=3.2}
ggplot(rand_distn, aes(x = diffmean)) +
  geom_histogram(color = "white", bins = 20)
```
- Where will the center of this distribution always be for tests of this sort?
--

    - 0 (We assumed the means were the same & used that process to build the distribution).

---

## View the _p_-value

### We want to see where our observed effect (the original different in sample means) falls on our NULL DISTRIBUTION.

- Note that we check for both directions here since we had a two-sided <small> $H_A$. </small>

```{r fig.height=2.7}
ggplot(rand_distn, aes(x = diffmean,
                      fill = (abs(diffmean) >= obs_diff))) +
  geom_histogram(color = "white", bins = 20)
```

---

## View the $p$-value

```{r fig.height=5}
 ggplot(data = rand_distn, aes(x = diffmean)) +
  geom_histogram(color = "white", bins = 20) +
  geom_vline(xintercept = obs_diff, color = "red") +
  geom_vline(xintercept = -obs_diff, color = "red")
```

---

## Calculate the _p_-value

```{r}
pvalue <- rand_distn %>%
  filter(abs(diffmean) >= obs_diff) %>%
  nrow() / nrow(rand_distn)
pvalue
```

### So there is around a `r round(pvalue * 100)`%  chance we could have seen results such as this (or MORE EXTREME) if the true population mean percentages were the same.  What does that mean?

---

## Significance level

- The "beyond a reasonable doubt" in statistics corresponds to setting the $\alpha$ value before you conduct your test.  Most often this is set to 5%.

- So with our test, since `r pvalue` > 0.05, we fail to reject <small> $H_0$ </small> in favor of <small> $H_A$ </small>.  

- We DO NOT have evidence to support the claim that the mean percentages of black residents per county are different for Washington and Oregon.

---

## All data

- The 2015 data for ALL counties is available via:

```{r eval=FALSE}
cc_full <- read_csv("http://ismayc.github.io/cc_full.csv")
```

- Practice:  Determine what the actual difference is in mean percentage of black residents for ALL Washington and Oregon counties using code similar to what we did earlier.  

- Is the difference **practically** large?

```{r include=FALSE}
cc_full %>% filter(state %in% c("Oregon", "Washington")) %>% 
  group_by(state) %>% 
  summarize(mean_perc = mean(black_perc))
```

---

# Problem Set 11

- Due at the beginning of class this Thursday
- Turn in individually [prefer pencil-and-paper] (You can work with your peers but you'll get more learning if you compare answers AFTER you have tried them on your own.)
***
- Do problems LC7.1 - LC7.5
- Read the two articles from 538
  - [Statisticians Found One Thing They Can Agree On: Itâ€™s Time To Stop Misusing P-Values](http://fivethirtyeight.com/features/statisticians-found-one-thing-they-can-agree-on-its-time-to-stop-misusing-p-values/)
  - [Science Isn't Broken](https://fivethirtyeight.com/features/science-isnt-broken/?ex_cid=endlink#part4)
  - Answer the questions corresponding [here](https://ismayc.github.io/soc301_s2017/problem-sets/index.html#ps11)
---

layout: true

.footer[[Week 11 - Thursday](https://ismayc.github.io/soc301_s2017/2017/04/13/week-11---thursday/)]

---


name: week11th
class: center, middle

# Week 11 - Thursday

# April 13, 2017
---


# Review Midterm Exam

- Here are the [solutions](Midterm_ExamKey.pdf)

---

# RStudio Tools

### All hail the <small>`mosaic`</small> package. Load as usual: <small>`library(mosaic)`</small>

### The following four functions will give us (most of) the random simulation tools we need:

1. `rflip()`: Flip a coin
1. `shuffle()`: Shuffle a set of values (akin to cards)
1. `do()`: Do the same thing many, many, many times
1. `resample()`: the swiss army knife of functions

---

## R Simulations Example

### First load up RStudio

- Create new R script file, type the following commands (not the comments), and run them in your R Console

```{r, message=FALSE, echo=TRUE}
# Load packages, including mosaic package
library(dplyr)
library(ggplot2)
library(mosaic)
# Flip a coin once. Try this multiple times:
rflip()
```

---

## R Simulations Example

```{r echo=TRUE}
# Flip a coin 10 times. Try this multiple times:
rflip(10)
```

---

## R Simulations Example

```{r echo=TRUE}
# Flip a coin 10 times, but do this 5 times. Try this multiple times
do(5) * rflip(10)
```

---

## R Simulations Example

```{r echo=TRUE}
# Flip a coin 10 times, but do this 5000 times
do(5000) * rflip(10)
```

---

## R Simulations Example

```{r cache=TRUE, echo=TRUE}
# Gah! There are too many rows!
simulations <- do(5000) * rflip(10)
```
```{r eval=FALSE, echo=TRUE}
# We could also View() it
View(simulations)
```

---

## R Simulations Example

```{r echo=TRUE, fig.height=5}
# Plot our resulting proportions
ggplot(data = simulations, aes(x = prop)) +
  geom_histogram(binwidth = 0.1, color = "white")
```

---

## R Simulations Example

```{r echo=TRUE, fig.height=5}
# Plot our resulting proportions
ggplot(data = simulations, mapping = aes(x = factor(prop))) +
  geom_bar()
```


---


## Shuffling AKA Permuting

Shuffling AKA re-ordering AKA **permuting** are all synonyms. I'm going to use
all three terms interchangeably. 

Type the following code into your R script:

```{r, eval=FALSE}
library(mosaic)
# Define a vector fruit
fruit <- c("apple", "orange", "mango")

# Do this multiple times:
shuffle(fruit)
```

---


## Shuffling AKA Permuting

This works with the `do()` operator...

```{r, eval=FALSE}
do(5) * shuffle(fruit)
```

... as well as within a `mutate()`



```{r, eval=FALSE}
example_data <- data_frame(
  name = c("Ilana", "Abbi", "Hannibal"),
  fruit = c("apple", "orange", "mango")
)

# Run this multiple times: 
example_data %>% mutate(fruit = shuffle(fruit))
```

---

## Key Distinction

### A *huge* distinction in types of sampling:

1. Sampling **with** replacement
1. Sampling **without** replacement

---

## Resampling

### At its most basic, `resample()` resamples the input vector **with** replacement. Run this in the console multiple times from your R script:

```{r, eval=FALSE}
resample(fruit)
```

* You can get the same fruit all three times i.e. sampling with replacement
* `resample()` has default settings that we can set to fit our needs; it is a swiss army knife.
* Let's unpack the defaults:

---


## Resampling

```{r, eval=FALSE}
resample(x = fruit, size = length(x), replace = TRUE, 
         prob = rep(1 / length(x), times = length(x)) )
```

* <small>`x`</small> is the input. In this case <small>`fruit`</small>.
* <small>`size`</small>: size of output vector. By default the same size as <small>`x`</small>.
* <small>`replace`</small>: Sample **with** or **without** replacement. By default with replacement.
* <small>`prob`</small>: Probability of sampling each input value. By default, equal probability
* Run the following.  What does it do?

```{r eval=FALSE}
rep(1/length(fruit), times = length(fruit))
```

---

## Scenario for Today

* Say you are a statistician and you meet someone called the "Lady Tasting Tea."
* She claims she can tell by tasting whether the tea or the milk was added first to a cup.
--

* You want to test whether
    + She can actually tell which came first **OR**
    + She's lying and is only guessing at random
--
* Say you have just enough tea/milk to pour into 10 cups.

---

## Lady Tasting Tea

* Lady Tasting Tea claims she can tell if tea or milk was poured first into a cup
* You run an experiment with 10 cups if she can tell or if she is bullshitting
* Let's _assume a hypothetical world where she is guessing at random_.

---

## Lady Tasting Tea

### If guessing at random, here are the *hypothetical* outcomes:

```{r, echo=FALSE, cache=TRUE, fig.height=5.5}
simulation <- do(5000) * rflip(10)
ggplot(simulation, aes(x = heads)) + 
  geom_bar() +
  labs(x="Number of Guesses Correct")
```

---

## Lady Tasting Tea

She got 9/10 right!

```{r, cache=TRUE}
ggplot(simulation, aes(x = heads)) + 
  geom_bar() +
  labs(x = "Number of Guesses Correct") +
  geom_vline(xintercept = 9, color = "red")
```

---

## Lady Tasting Tea

She got 9/10 right!

```{r, cache=TRUE}
ggplot(simulation, aes(x = heads)) + 
  geom_bar() +
  labs(x = "Number of Guesses Correct") +
  geom_vline(xintercept = 9, color = "red") +
  scale_x_continuous(breaks = 0:10)
```

---

## Lady Tasting Tea

* In our hypothetical world of guessing at random, 9/10 OR MORE occured 
`r sum(simulation$heads == 9) + sum(simulation$heads == 10)` times out of `r nrow(simulation)`. i.e. <br>
`r round(100*(sum(simulation$heads == 9) + sum(simulation$heads == 10))/nrow(simulation), 3)`% of the time. 
* Can she tell, or is she bullshitting?

---

## Problem Set 10

- Due by end of class today
- Turn in individually via pencil-and-paper

### [Learning Checks](https://ismayc.github.io/moderndiver-book/6-sim.html)

- LC6.1
- LC6.3
- LC6.9
- LC6.11
- LC6.13
- LC6.15

---

```{r old, child='temp_deck.Rmd'}
```